---
- name: Start Proxmox containers
  hosts: proxmox

  tasks:
    - name: Ensure containers are started
      community.general.proxmox:
        vmid: "{{ container_id }}"
        api_user: root@pam
        api_password: 1q2w3e
        api_host: node1
        state: started
      loop:
        - 101
        - 102
        - 103
        - 104
        - 111
        - 112

    - name: Ensure containers have an addressed ip
      ansible.builtin.command: "pct exec {{ item }} dhclient"
      loop:
        - 101
        - 102
        - 103
        - 104
        - 111
        - 112

- name: Ensure containers are updated
  hosts:
    - infrastructure
    - entertainment
    - projects

  tasks:
    - name: Update cache if needed (Debian)
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 3600
      when: ansible_os_family == "Debian"

    - name: Update packages
      ansible.builtin.package:
        name: "*"
        state: latest
